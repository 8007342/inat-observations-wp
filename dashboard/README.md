# iNaturalist Observations WP - Project Dashboard

**STATIC BUILD ARTIFACTS** - Generated automatically during pre-commit

This directory contains static HTML/Markdown reports generated by standard build tools. All files here are build artifacts and should not be edited manually.

---

## What's Here

```
dashboard/
├── README.md              # This file
├── coverage/              # PHPUnit HTML coverage report (auto-generated)
│   └── index.html         # View at: file:///.../dashboard/coverage/index.html
├── metrics.json           # Machine-readable metrics snapshot (auto-generated)
├── metrics.md             # Human-readable metrics report (auto-generated)
└── history/               # Historical metrics (timestamped snapshots)
    └── YYYY-MM-DD-HHMMSS-metrics.json
```

---

## Viewing the Dashboard

### In Browser (Recommended)

```bash
# Open coverage report
open dashboard/coverage/index.html

# Or for Linux
xdg-open dashboard/coverage/index.html
```

### On GitHub

- View `dashboard/metrics.md` for current project health
- Coverage reports are HTML (GitHub won't render, need to clone and view locally)

### In Terminal

```bash
# Quick metrics view
cat dashboard/metrics.md

# JSON metrics
jq '.' dashboard/metrics.json
```

---

## How Artifacts Are Generated

### Automatic (Pre-Commit Hook)

Every commit automatically regenerates dashboard artifacts:

```bash
.git/hooks/pre-commit
├── Run PHPUnit with coverage  → dashboard/coverage/
├── Generate metrics.json       → dashboard/metrics.json
├── Generate metrics.md         → dashboard/metrics.md
└── Snapshot to history/        → dashboard/history/
```

### Manual Build

```bash
# Generate all dashboard artifacts
composer dashboard:build

# Or run individual targets
composer test:coverage          # → coverage/
composer metrics:generate       # → metrics.json, metrics.md
```

---

## Build Targets

Defined in `composer.json`:

```json
{
  "scripts": {
    "test:coverage": "phpunit --coverage-html dashboard/coverage --coverage-clover dashboard/coverage/clover.xml",
    "metrics:generate": "php bin/generate-metrics.php",
    "dashboard:build": [
      "@test:coverage",
      "@metrics:generate"
    ]
  }
}
```

---

## Metrics Tracked

### Code Coverage (PHPUnit)

- **Line Coverage**: % of code lines executed by tests
- **Function Coverage**: % of functions covered by tests
- **Class Coverage**: % of classes with test coverage
- **File-by-File Breakdown**: Detailed per-file metrics

**Target:** 97%+ line coverage

### Code Quality (PHP_CodeSniffer)

- **Warnings**: 0 warnings allowed
- **Errors**: 0 errors allowed
- **Standard**: WordPress Coding Standards

**Target:** 0 warnings, 0 errors

### Dead Code Detection (PHP-Assumptions/PHPMD)

- **Dead Code %**: Unused functions, classes, variables
- **Cyclomatic Complexity**: Functions with complexity > 10

**Target:** 0% dead code in production files

### Test Quality

- **Total Tests**: Count of test cases
- **Test Execution Time**: Total time to run suite
- **Assertions Count**: Total assertions across all tests

**Target:** Comprehensive test suite with meaningful assertions

---

## Quality Gates

Dashboard metrics enforce quality gates in CI/CD:

```yaml
# .github/workflows/quality-gates.yml
- name: Check Code Coverage
  run: |
    COVERAGE=$(jq -r '.coverage.line_percentage' dashboard/metrics.json)
    if (( $(echo "$COVERAGE < 97" | bc -l) )); then
      echo "❌ Coverage below 97%: $COVERAGE%"
      exit 1
    fi

- name: Check Warnings
  run: |
    WARNINGS=$(jq -r '.quality.warnings' dashboard/metrics.json)
    if [ "$WARNINGS" -gt 0 ]; then
      echo "❌ Found $WARNINGS warnings"
      exit 1
    fi
```

---

## Metrics Snapshot Format

`metrics.json` structure:

```json
{
  "generated": "2026-01-06T14:30:00Z",
  "git_commit": "abc123...",
  "coverage": {
    "line_percentage": 97.5,
    "function_percentage": 98.2,
    "class_percentage": 100.0,
    "total_lines": 1234,
    "covered_lines": 1203,
    "files": [
      {
        "file": "includes/api.php",
        "line_coverage": 95.3,
        "status": "good"
      }
    ]
  },
  "quality": {
    "warnings": 0,
    "errors": 0,
    "dead_code_percentage": 0.0
  },
  "tests": {
    "total": 42,
    "passed": 42,
    "failed": 0,
    "execution_time_seconds": 2.34
  }
}
```

---

## Tools Used

All standard, open-source tools:

- **PHPUnit**: Code coverage (HTML + Clover XML)
- **PHP_CodeSniffer**: Code quality analysis
- **PHPMD**: Dead code detection
- **jq**: JSON processing (metrics extraction)

---

## Historical Trends

Metrics are snapshotted on each commit to `dashboard/history/`:

```bash
# View coverage trend over last 10 commits
ls -lt dashboard/history/ | head -10 | while read line; do
  file=$(echo $line | awk '{print $9}')
  coverage=$(jq -r '.coverage.line_percentage' dashboard/history/$file)
  echo "$file: $coverage%"
done
```

---

## Integration with TODO-QA

See `TODO-QA-001-track-code-coverage-metrics.md` for:
- Coverage improvement roadmap
- File-by-file coverage targets
- Testing strategy and priorities

---

## Best Practices

1. **Never edit dashboard files manually** - They're build artifacts
2. **Always run `composer dashboard:build` before committing** - Or rely on pre-commit hook
3. **Check metrics.md for quick health check** - Human-readable summary
4. **Use metrics.json in CI/CD** - Machine-readable for automation
5. **Review coverage/index.html** - Detailed file-by-file breakdown

---

## Troubleshooting

### Coverage report not generated

```bash
# Check PHPUnit is installed
composer install

# Manually run coverage
composer test:coverage

# Check output
ls -la dashboard/coverage/
```

### Metrics JSON missing

```bash
# Check bin/generate-metrics.php exists
ls -la bin/generate-metrics.php

# Run manually
php bin/generate-metrics.php

# Check output
cat dashboard/metrics.json
```

### Pre-commit hook not working

```bash
# Check hook is installed
ls -la .git/hooks/pre-commit

# Reinstall hook
composer install-hooks
```

---

**Last Updated:** 2026-01-06
**Maintainer:** Ayahuitl Tlatoani
**Status:** Static Build Artifacts
